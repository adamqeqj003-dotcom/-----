<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>智能书签整理器 - 控制台</title>
    <link rel="stylesheet" href="lib/tailwind.min.css">
    <link rel="stylesheet" href="popup.css">
    <style>
        /* 独立页面样式调整 */
        body {
            min-height: 100vh;
            display: flex;
            justify-content: center;
            padding: 2rem;
        }

        .dashboard-container {
            width: 100%;
            max-width: 800px;
        }
    </style>
</head>

<body class="bg-dark text-green-terminal font-mono">

    <div class="dashboard-container">
        <!-- ==================== Dashboard Header ==================== -->
        <header class="flex justify-between items-center mb-6">
            <h1 class="text-xl font-bold">📚 智能书签整理器</h1>
            <div class="text-sm text-gray-secondary">独立控制台 - 可自由切换标签页</div>
        </header>

        <!-- Status Bar -->
        <div class="status-bar flex items-center gap-4 mb-4 text-sm">
            <div class="flex items-center gap-2">
                <span id="status-dot" class="status-dot disconnected"></span>
                <span id="status-text">未连接</span>
            </div>
            <div class="text-gray-secondary">
                延时: <span id="status-delay">500</span>ms
            </div>
            <button id="btn-settings" class="ml-auto text-sm text-gray-secondary hover:text-green-terminal">
                ⚙️ 设置
            </button>
        </div>

        <!-- Progress Section (Hidden by default) -->
        <div id="progress-section" class="hidden mb-4">
            <!-- 警告条 -->
            <div class="warning-banner">
                ⚠️ 正在处理中... 此页面可在后台运行，切换标签不会中断任务！
            </div>

            <!-- 进度条 -->
            <div class="progress-container">
                <div class="flex justify-between text-xs mb-1">
                    <span id="progress-text">处理中: 0/0</span>
                    <button id="btn-stop" class="stop-btn">停止</button>
                </div>
                <div class="progress-bar-bg">
                    <div id="progress-bar" class="progress-bar-fill" style="width: 0%"></div>
                </div>
            </div>
        </div>

        <!-- Main Content Grid -->
        <div class="grid grid-cols-2 gap-4 mb-4">
            <!-- Left: Action Area -->
            <div class="action-area space-y-3">
                <h2 class="text-sm text-gray-secondary mb-2">📋 操作</h2>
                <button id="btn-quick-tidy" class="action-btn w-full">
                    ⚡ 快速整理 (仅根目录散乱项)
                </button>
                <button id="btn-deep-clean" class="action-btn w-full">
                    🔥 深度清理 (全部)
                </button>
                <button id="btn-select-folder" class="action-btn w-full">
                    📁 选择指定文件夹
                </button>
                <button id="btn-whitelist" class="action-btn w-full mt-4">
                    🔒 管理白名单
                </button>
            </div>

            <!-- Right: Log Console -->
            <div class="log-console-container" style="height: 300px;">
                <div class="log-header">
                    <span>📟 控制台</span>
                    <button id="btn-clear-log" class="text-xs text-gray-secondary hover:text-green-terminal">清空</button>
                </div>
                <div id="log-console" class="log-console" style="height: calc(100% - 2rem);">
                    <div class="log-line">> 系统就绪...</div>
                </div>
            </div>
        </div>

        <!-- Settings Panel (Collapsible) -->
        <div id="settings-panel" class="hidden settings-group mb-4 p-4 border border-green-dark rounded">
            <h2 class="settings-title mb-4">⚙️ 设置</h2>

            <div class="grid grid-cols-2 gap-4">
                <!-- Connection -->
                <div>
                    <h3 class="text-sm text-gray-secondary mb-2">🔗 API 连接</h3>
                    <div class="form-field">
                        <label for="input-api-url">API Base URL</label>
                        <input type="text" id="input-api-url" value="https://api.deepseek.com"
                            placeholder="https://api.deepseek.com">
                    </div>
                    <div class="form-field">
                        <label for="input-api-key">API Key</label>
                        <input type="password" id="input-api-key" placeholder="sk-xxxxxxxxxxxxxxxx">
                    </div>
                    <button id="btn-test-connection" class="action-btn w-full mt-2">
                        🧪 测试连接
                    </button>
                </div>

                <!-- Strategy -->
                <div>
                    <h3 class="text-sm text-gray-secondary mb-2">📋 策略设置</h3>
                    <div class="toggle-field">
                        <label for="toggle-dead-link">检测死链</label>
                        <input type="checkbox" id="toggle-dead-link" class="toggle-input" checked>
                    </div>
                    <div class="toggle-field">
                        <label for="toggle-scatter">强制打散模式</label>
                        <input type="checkbox" id="toggle-scatter" class="toggle-input">
                    </div>
                    <div class="toggle-field">
                        <label for="toggle-prefix">添加分类前缀</label>
                        <input type="checkbox" id="toggle-prefix" class="toggle-input" checked>
                    </div>
                    <div class="form-field mt-2">
                        <label for="input-delay">请求延时 (ms)</label>
                        <input type="number" id="input-delay" value="500" min="100" max="5000" step="100">
                    </div>
                </div>
            </div>

            <button id="btn-save-settings" class="action-btn action-btn-primary w-full mt-4">
                💾 保存设置
            </button>
        </div>
    </div>

    <!-- ==================== Modal: Folder Selector ==================== -->
    <div id="modal-folder" class="modal-overlay hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h3>📂 选择文件夹</h3>
                <button class="modal-close" data-modal="modal-folder">&times;</button>
            </div>
            <div class="modal-body">
                <div id="folder-tree" class="folder-tree">
                    <div class="text-gray-secondary text-sm">加载中...</div>
                </div>
            </div>
            <div class="modal-footer">
                <button id="btn-confirm-folder" class="action-btn action-btn-primary" disabled>确认选择</button>
                <button class="action-btn modal-close" data-modal="modal-folder">取消</button>
            </div>
        </div>
    </div>

    <!-- ==================== Modal: Whitelist Manager ==================== -->
    <div id="modal-whitelist" class="modal-overlay hidden">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h3>🔒 白名单管理</h3>
                <button class="modal-close" data-modal="modal-whitelist">&times;</button>
            </div>
            <div class="modal-body">
                <div class="mb-4">
                    <button id="btn-add-to-whitelist" class="action-btn w-full">
                        ➕ 添加文件夹/书签到白名单
                    </button>
                </div>
                <div class="text-xs text-gray-secondary mb-2">已锁定项目:</div>
                <div id="whitelist-container" class="whitelist-list">
                    <div class="text-gray-secondary text-sm text-center py-4">暂无锁定项</div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="action-btn modal-close" data-modal="modal-whitelist">关闭</button>
            </div>
        </div>
    </div>

    <!-- ==================== Toast Notification ==================== -->
    <div id="toast" class="toast hidden">
        <span id="toast-message"></span>
    </div>

    <!-- Scripts -->
    <script src="src/config.js"></script>
    <script src="src/logger.js"></script>
    <script src="src/bookmarkOps.js"></script>
    <script src="src/cleaner.js"></script>
    <script src="src/deepseek.js"></script>
    <script src="dashboard.js"></script>
</body>

</html>